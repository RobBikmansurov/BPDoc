-search "Контрагент" 
-title "Список контрагентов"
%section.hero.is-primary
  .hero-body
    .container
      %h1.title
        Список контрагентов
        -if params[:search].present?
          [ 
          = params[:search]
          ]
      %h2.subtitle
        Контрагенты, подрядчики для договоров
        = link_to 'процессов', bproces_path
        %p.notice= notice
.container
  %table.table.is-striped.is-bordered.is-hoverable.is-fullwidth
    %thead
      %tr
        %th #
        -#= sortable "id", "#"
        %th Наименование
        %th Город
        %th Контакты
        -if can? :update, Agent
          %th
        -if can? :destroy, Agent
          %th
      - @agents.each do |agent|
        %tr
          %td
            .id_show_
              = "##{agent.id}"
          %td= link_to agent.name, agent
          %td= agent.town
          %td=  truncate(agent.contacts, :length => 80, :omission => ' ...')
          - if can? :manage, agent
            %td= link_to image_tag('page_edit.gif', :alt => 'Изменить'),  edit_agent_path(agent), class: 'button-img'
          - if can? :destroy, agent
            %td=link_to image_tag('action_stop.gif', :alt => 'Удалить'), agent, data: { confirm: 'Контрагент"' + agent.name + "\"\nДействительно хотите удалить?" }, :method => 'delete', class: 'button-img'
.container
  .apple_pagination
    = will_paginate @agents
.container
  - if can? :destroy, Agent
    %a.button.is-primary{ href: new_agent_path } Добавить Контрагента
.container
  .buttons
    СЭД:
    &nbsp;
    - Agent.select('dms_name, count(id) as count').group(:dms_name).order(:dms_name).each do |d|
      - if d.dms_name
        %a.button.is-outlined.is-info{ href: agents_path(dms_name: d.dms_name) } #{d.dms_name}
