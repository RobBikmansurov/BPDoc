-search "Задачи" 
-title @title_tasks

%h2
  = @title_tasks if @title_tasks
  -if params[:search].present?
    = "[ #{params[:search]} ]"

%table
  %tr
    %th #
    %th Наименование
    %th Описание
    %th Источник
    %th Срок
    %th Статус
    %th Ответственные
    %th

  -if @tasks
    - @tasks.each do |task|
      %tr
        %td= task.id
        %td= link_to task.name, task
        %td= truncate(task.description, :length => 50, :omission => ' ...')
        %td
          = link_to "Письмо #{task.letter_id}", letters_path(task.letter_id) if task.letter_id
          = link_to "Требование ##{task.requirement_id}", requirement_path(task.requirement_id) if task.requirement_id

        %td= task.duedate.strftime("%d.%m.%Y") if task.duedate
        %td= TASK_STATUS.key(task.status)
        %td
          -task.user_task.each do |user_task|
            -if user_task.user
              - s = "#{user_task.user.displayname}"
              -if !user_task.status.blank?
                - s = s + "\u2713".html_safe
              = link_to s, user_task.user
            -else
              удалить ссылку
              = user_task.inspect
        -#%td= letter.letter
        - if true or can? :manage, task or can? :destroy, task
          %td
            = link_to image_tag('page_edit.gif', :alt => 'Изменить'), edit_task_path(task), class: 'button-img'
            = link_to image_tag('action_stop.gif', :alt => 'Удалить'), task, 
            data: { confirm: "Задача #{task.name}" + "\nДействительно хотите удалить?" }, 
            :method => 'delete', class: 'button-img'

%br
.apple_pagination
  = will_paginate @tasks if @tasks

