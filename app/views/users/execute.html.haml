#Executes
-if @letters.count > 0
  %h2
    Требуют внимания Письма
    = link_to "(#{@letters.count})", letters_path(user: @usr)
    \:
  %table
    %tr
      %th #
      %th Исх.№
      %th [ Тема ]
      %thКорреспондент
      %thСрок
      %thСтатус

    -# letters.select('letters.status, count(letters.id) as count').group(:status).each do | letter |
    - @letters.each do |letter|
      %tr
        %td= letter.id
        %td
          = link_to letter.number, letter
          от 
          = letter.date.strftime("%d.%m.%y") if letter.date
        %td
          -if letter.letter_appendix.first  # если есть приложение 
            - if File.exist?(letter.letter_appendix.first.appendix.path)
              = link_to image_tag('action_go.gif', alt: 'См.', title: 'Смотреть'), letter.letter_appendix.first.appendix.url, class: 'button-img'
          = link_to letter.subject, letter
        %td= letter.sender
        %td
          -if letter.duedate
            -if letter.status < 90 and letter.duedate <= Date.current
              %span{:style => "color: red;"}
                = letter.duedate.strftime("%d.%m.%y")
            -else
              = letter.duedate.strftime("%d.%m.%y")
            -if letter.completion_date
              -if letter.completion_date > letter.duedate
                %br
                  %span{:style => "color: red;"}
                    = letter.completion_date.strftime("%d.%m.%y")
        %td= LETTER_STATUS.key(letter.status)

-if @requirements.count > 0
  %h2
    Требуют внимания Требования
    = link_to "(#{@requirements.count})", requirements_path(user: @usr)
    \:
  %table
    %tr
      %th #
      %th Метка, обозначение
      %th Содержание
      %th Срок
      %th Статус
  
    - @requirements.each do |requirement|
      %tr
        %td= requirement.id
        %td
          = link_to requirement.label, requirement
          = requirement.date.strftime("%d.%m.%Y")
        %td= link_to requirement.body, requirement
        %td= requirement.duedate.strftime("%d.%m.%Y") if requirement.duedate
        %td= REQUIREMENT_STATUS.key(requirement.status)
