-# основные реквизиты Процесса
= simple_form_for(@bproce) do |f|
  = f.error_notification
  = f.input :shortname
  = f.input :name
  = f.input :fullname
  = f.input :goal
  -#if @bproce.new_record?
  = f.label 'Родительский процесс'
  = f.select :parent_id, nested_set_options(Bproce, @bproce) {|i| "#{'-' * i.level} #{i.name}" }

  = f.error :base
  = f.button :submit
%p
-# не показывать для нового процесса связанные с ним объекты - их еще нет
-if @bproce.id?
  %table
    %tr
      %th
        В процессе участвуют
        =link_to 'Роли:', bproce_role_path(@bproce)
      %th
        Процесс описывают
        =link_to 'Документы:', bproce_document_path(@bproce)
    %tr
      %td
        -@bproce.roles.find_with_associations.each do |role|
          = link_to role.name, edit_role_path(role)
          = link_to 'Destroy', role, :confirm => 'Are you sure?', :method => :delete
          %br
        = simple_form_for(@role) do |r|
          = r.error_notification
          = r.input :name
          = r.input :description
          = r.hidden_field :bproce_id
          = r.error :base
          = r.button :submit, 'Добавить Роль'
      %td
        -@bproce.documents.find_with_associations.each do |doc|
          = link_to doc.name, edit_document_path(doc)
          = ' ' + doc.approved.to_s
          %br
        = simple_form_for(@document) do |r|
          = r.error_notification
          = r.input :name
          = r.hidden_field :bproce_id
          = r.error :base
          = r.button :submit, 'Добавить Документ'
  %table
    %tr
      %th
        В процессе используются
        =link_to 'Приложения:', bproce_bapp_path(@bproce)

      %th
        В процессе участвуют
        =link_to 'Рабочие Места:', bproce_workplace_path(@bproce)
    %tr
      %td
        -@bproce.bapps.each do |ba|
          = link_to ba.name, edit_bapp_path(ba)
          %br
      %td
        -@bproce.workplaces.each do |wp|
          = link_to wp.designation, edit_workplace_path(wp)
          %br
-#=debug params
-#=debug @bproce
-#=debug @role
