- title 'Роль ' + @business_role.name + '. ' + @business_role.bproce.shortname if @business_role.bproce
- search 'Роль'
%section.hero.is-primary
  .hero-body
    .columns
      .column
        %h2.title
          Роль [ #{@business_role.name}]
      .column.is-1
        %h2.title
          \##{@business_role.id}
    %h2.subtitle
      в процессе
      %b 
        = link_to @business_role.bproce&.name, bproce_business_role_path(@business_role.bproce)
      - if @business_role.bproce && @business_role.bproce.business_roles.any?
        , другие роли процесса: 
        - @business_role.bproce.business_roles.each do |role|
          - unless @business_role.id == role.id
            %a.button.is-link.is-outlined{ href: business_role_path(role) } #{role.name} 
      %p.notice= notice
%section
  .container
    .content
      %h3 Действия в процессе:
      = markdown(@business_role.description)
      - if current_user&.role? :admin
        %h4 Особенности настройки:
        = @business_role.features
      %h4
        Исполнители роли [#{@business_role.name}]:
      %table
        %tr
          %th ФИО
          %th Период
          %th Основание
          %th Процесс
        - @business_role.user_business_role.order(:date_from).each do |business_role|
          - next unless business_role.user.active
          %tr
            - if business_role.user
              %td{ style: ('text-decoration: line-through;' unless business_role.user.active) }
                = link_to business_role.user.displayname, business_role.user
                = link_to business_role.user.office, users_path + '?office=' + business_role.user.office, class: 'groups' if business_role.user.office
            - else
              %td
                удалить ссылку
                = business_role.inspect
            %td
              = business_role.date_from.strftime('%d.%m.%Y') if business_role.date_from
              \-
              = business_role.date_to.strftime('%d.%m.%Y') if business_role.date_to
              - if can? :update, @business_role
                %td= link_to !business_role.note.empty? ? business_role.note : ' - ', edit_user_business_role_path(business_role)
              - else
                %td= business_role.note.to_s
            %td
              - if business_role.business_role.bproce
                = link_to business_role.business_role.bproce.shortname, bproce_business_role_path(business_role.business_role.bproce)
              - else business_role.business_role.inspect

.container
  .columns
    .column
      %a.button.is-primary{ href: :back } Back
      - if can? :update, @business_role
        %a.button.is-primary{ href: edit_business_role_path(@business_role) } Edit
    .column
      - if can? :update, @business_role
        #create_user
          %a.button.is-info.is-outlined{ href: create_user_business_role_path(@business_role), "data-remote": true } Добавить Исполнителя

    .column
      - if can? :update, @business_role
        #mail
          %a.button.is-info.is-outlined{ href: mail_business_role_path(@business_role), "data-remote" => "true" } Отправить всем исполнителям сообщение
    .column
      .info_
        - activity1 = PublicActivity::Activity.where(trackable_type: 'BusinessRole', trackable_id: @business_role.id).order('created_at asc').first
        - if activity1
          = link_to 'создал', activities_path(type: 'BusinessRole', id: @business_role.id)
          = activity1.updated_at.strftime('%d.%m.%Y %H:%M:%S')
          - unless activity1.owner.nil?
            = activity1.owner.displayname.to_s
        - else
          создана
          = @business_role.created_at.strftime('%d.%m.%Y %H:%M:%S')
        %br
        - activity2 = PublicActivity::Activity.where(trackable_type: 'BusinessRole', trackable_id: @business_role.id).order('created_at asc').last
        - if activity2
          = link_to 'изменил', activities_path(type: 'BusinessRole', id: @business_role.id)
          = activity2.updated_at.strftime('%d.%m.%Y %H:%M:%S')
          - unless activity2.owner.nil?
            = activity2.owner.displayname.to_s
        - else
          изменена
          = @business_role.updated_at.strftime('%d.%m.%Y %H:%M:%S')
